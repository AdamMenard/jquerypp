<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
            "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
	<head>
		<title>Fixture Demo</title>
        <style type='text/css'>
            body {font-family: verdana}
            
        </style>
	</head>
	<body>
<div id="demo-html">
<div id='content'></div>
</div>
<script type='text/javascript'  
		src='../../../steal/steal.js'></script>
<script type='text/javascript'>
steal.plugins('jquery/dom/fixture','jquery/dom/form_params').start()
</script>

<script type='text/javascript' id="demo-source">
// a basic fixture for html
$.get("messages.php",function(html){
	$('#content').html(html)
}, 'text','fixtures/messages.html')

$("#getMessages").live("submit",function(ev){
	ev.preventDefault();
	
	var params = $(this).formParams().params;
	
	params.parentId = params.parentId || null
	
	$.get("messages",params,
		function(json){
			$("#messages").html( messagesHTML(json.data) )
		},"json","-messages")
})

// a basic dynamic fixture
$.fixture["-createMessage"] = function(settings, cbType){
	var message = $.extend({
		id: arguments.callee.count++,
		user: "Justin",
		createdAt: String(new Date())
	}, settings.data)
	message.id = $.fixture["~messages"].length;
	$.fixture["~messages"].push(message)
	return [message];
};

// a make fixture
$.fixture["-make"](["messages","message"],1000, function(i, messages){
  return {
    subject: "This is message "+i,
    body: "Here is some text for this message",
	user: "Justin",
	createdAt: String(new Date( Math.random() *  new Date().getTime()   )),
  }
});


var messagesHTML = function(messages){
	var html = ["<table>"];
	$.each(messages, function(message){
		html.push("<tr>")
		for(var prop in this){
			if ($.inArray(prop, ['id']) != -1) {
				continue;
			}
			html.push("<td>"+this[prop]+"</td>")
		}
		html.push("</tr>")
	})
	html.push("</table>");
	return html.join("");
}





</script>
	</body>
</html>